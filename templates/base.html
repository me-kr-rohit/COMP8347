{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}My Django App{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <!--link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"-->

    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f4f4;
        }

        nav {
            background-color: #333;
            padding: 10px 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        li {
            margin: 0 15px;
        }

        a {
            text-decoration: none;
            color: #fff;
            font-weight: bold;
            font-size: 16px;
        }

        a:hover {
            color: #ddd;
        }

        .content {
            width: 100%;
            max-width: 800px; /* Adjust as needed */
            margin-top: 70px;
        }
        .logo{
            max-width: 100px;
        }
         .logout-btn {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

    .user-logo {
      max-width: 35px;
    }
    .navbar-nav2 {



}
    </style>
</head>
<body>
    <nav>
        <ul>
             <li><a class="logo-btn" href="{% url 'home' %}"><img class="logo" src="{% static '/images/logo.png' %}" alt="Logo"></a></li>
        </ul>
     <ul class="navbar-nav2">
            <li><a class="nav-link" href="{% url 'about' %}">About Us</a></li>
            <li>
                    {% csrf_token %}
                    <label for="servicesDropdown" class="nav-link"></label>
                    <div class="d-flex flex-column">
                    <select class="form-control" id="quickAccessDropdown" name="quickAccessDropdown" onchange="loadTrendChart();">
                        <option value="#quickAccess" selected disabled>Quick Access</option>
                        <option value="CAD">USD->CAD</option>
                        <option value="INR">USD->INR</option>
                        <option value="EUR">USD->EUR</option>
                        <!-- Add more options as needed -->
                    </select>
                </div>
            </li>
           {% if user.is_authenticated %}
          <li>
                <label for="servicesDropdown" class="nav-link"></label>
                <div class="d-flex flex-column">
                    <select class="form-control" id="servicesDropdown" name="servicesDropdown" onchange="toggleCardVisibility();">
                        <option value="#selectService" selected disabled>Select a Service</option>
                        <option value="#exchangeRate">Exchange Rate</option>
                        <option value="#currentTrend">Current Trends</option>
                        <!-- Add more options as needed -->
                    </select>
                </div>
            </li>
           {% endif %}
           <li><a class="nav-link" href="{% url 'offers' %}">Offers</a></li>
            <li><a class="nav-link" href="{% url 'faq' %}">FAQs</a></li>
            <li><a class="nav-link" href="{% url 'contactUs' %}">Contact Us</a></li>
     </ul>
        <ul>
            {% if user.is_authenticated %}
                <a class="my_account" href="{% url 'my_account' %}">
                        <img class="user-logo" src="{% static '/images/user.png' %}" alt="myAccountLogo">
                    </a>

              <li class="logout-btn">
                    <a href="{% url 'logout' %}">Logout</a>
                </li>
            {% else %}
                <li><a href="{% url 'register' %}">Register</a></li>
                <li><a href="{% url 'login' %}">Login</a></li>
            {% endif %}
            <!-- Add other navigation links as needed -->
        </ul>
    </nav>
    <div class="content">
        {% block content %}{% endblock %}
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Wait for the DOM to fully load before running the script
        loadTrendChart();
    });

    function loadTrendChart() {
        var selectedCurrencyOption = document.getElementById("quickAccessDropdown");

        // Check if an option is selected
        if (!selectedCurrencyOption || selectedCurrencyOption.selectedIndex === -1) {
            console.error("No currency selected");
            return;
        }

        // Get the selected option and its data-currency attribute
        var selectedOption = selectedCurrencyOption.options[selectedCurrencyOption.selectedIndex];

        // Extract the currency value from the option text (e.g., "USD->CAD")
        var optionText = selectedOption.textContent;
        var selectedCurrency = optionText.split("->")[1]?.trim();

        // Check if the selected option has the data-currency attribute
        if (!selectedCurrency) {
            console.error("Unexpected currency format:", selectedOption);
            return;
        }

        console.log("Selected Currency:", selectedCurrency);

        // Get today's date and format it as "YYYY-MM-DD"
        var today = new Date();
        var todayFormatted = today.toISOString().split('T')[0];

        // Calculate start date as today's date minus 365 days
        var startDate = new Date(today);
        startDate.setDate(startDate.getDate() - 10);
        var startDateFormatted = startDate.toISOString().split('T')[0];

        // Calculate end date as today's date minus one day
        var endDate = new Date(today);
        endDate.setDate(endDate.getDate() - 1);
        var endDateFormatted = endDate.toISOString().split('T')[0];

        // Get the CSRF token input
        var csrftokenInput = document.getElementsByName('csrfmiddlewaretoken')[0];

        // Check if the CSRF token input is found
        if (!csrftokenInput || !csrftokenInput.value) {
            console.error("CSRF token not found or empty");
            return;
        }

        var csrftoken = csrftokenInput.value;

        // Call the timeseries_view endpoint with the selected currency, start date, and end date
        // var url = "/timeseries_view/";
        var url = "{% url 'timeseries_view' %}";
        var formData = new FormData();
        formData.append("currencyYouWant", selectedCurrency);
        formData.append("fromDate", startDateFormatted);
        formData.append("toDate", endDateFormatted);

        fetch(url, {
            method: "POST",
            body: formData,
            headers: {
                'X-CSRFToken': csrftoken
            }
        })

        // window.location.href = url;
}
</script>







</body>
</html>
